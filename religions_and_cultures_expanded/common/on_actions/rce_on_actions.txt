on_startup = {
	country_event = { id = religions_and_cultures_expanded_events.1 } # set mod global flag
	1 = {
		if = {
			limit = {
				NOT = { has_province_modifier = rce_on_monthly_tick_triggered_modifier }
			}
			set_global_flag = rce_on_monthly_tick_triggered_modifier_initial_setup
			add_province_triggered_modifier = rce_on_monthly_tick_triggered_modifier
		}
	}
	# Startup Screen:
	if = {
		limit = {
			ai = no
			NOT = { has_country_flag = rce_had_startup_screen_window }
		}
		set_country_flag = rce_had_startup_screen_window
		set_country_flag = show_rce_startup_screen_window
		set_country_flag = show_rce_startup_screen_window_religions
		set_variable = { which = rce_startup_screen_window_selected_religion value = 0 }
		set_variable = { which = rce_startup_screen_window_religions_selected_page value = 1 }
	}
	# Modifiers for European Pagans:
	if = {
		limit = {
			religion_group = pagan
			capital_scope = {
				continent = europe
			}
			OR = {
				current_age = age_of_discovery
				current_age = age_of_reformation
				current_age = age_of_absolutism
			}
			OR = {
				technology_group = western
				technology_group = eastern
			}
			NOT = { has_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery }
			NOT = { has_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation }
			NOT = { has_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism }
		}
		if = {
			limit = {
				current_age = age_of_discovery
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_discovery
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_reformation
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_reformation
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_absolutism
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_absolutism
				duration = -1
			}
		}
	}
}

# ROOT = province, FROM = old owner
on_province_owner_change = {
	if = {
		limit = {
			area_for_scope_province = {
				has_province_modifier = rce_missionary_assigned_to_state_modifier
			}
		}
		area = {
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_main_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_main_modifier
			}
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_modifier
			}
			clr_province_flag = rce_missionary_assigned_to_state_flag
			set_variable = { which = rce_missionary_assigned_to_state_year value = 0 }
		}
	}
	if = {
		limit = {
			any_owned_province = {
				has_province_flag = rce_missionary_assigned_to_state_flag
				NOT = { has_province_modifier = rce_missionary_assigned_to_state_modifier }
			}
		}
		every_owned_province = {
			limit = {
				has_province_flag = rce_missionary_assigned_to_state_flag
				NOT = { has_province_modifier = rce_missionary_assigned_to_state_main_modifier }
				NOT = { has_province_modifier = rce_missionary_assigned_to_state_modifier }
			}
			clr_province_flag = rce_missionary_assigned_to_state_flag
			set_variable = { which = rce_missionary_assigned_to_state_year value = 0 }
		}
	}
}

# ROOT = province
on_province_religion_changed = {
	if = {
		limit = {
			area_for_scope_province = {
				has_province_modifier = rce_missionary_assigned_to_state_modifier
			}
		}
		area = {
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_main_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_main_modifier
			}
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_modifier
			}
			clr_province_flag = rce_missionary_assigned_to_state_flag
			set_variable = { which = rce_missionary_assigned_to_state_year value = 0 }
		}
	}
}

# ROOT = country
on_religion_change = {
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = rce_missionary_assigned_to_state_modifier
			}
		}
		every_owned_province = {
			limit = {
				has_province_modifier = rce_missionary_assigned_to_state_modifier
			}
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_main_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_main_modifier
			}
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_modifier
			}
			clr_province_flag = rce_missionary_assigned_to_state_flag
			set_variable = { which = rce_missionary_assigned_to_state_year value = 0 }
		}
	}
	if = {
		limit = {
			religion_group = pagan
			capital_scope = {
				continent = europe
			}
			OR = {
				current_age = age_of_discovery
				current_age = age_of_reformation
				current_age = age_of_absolutism
			}
			OR = {
				technology_group = western
				technology_group = eastern
			}
		}
		if = {
			limit = {
				current_age = age_of_discovery
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_discovery
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_reformation
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_reformation
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_absolutism
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_absolutism
				duration = -1
			}
		}
	}
}

# ROOT = country
on_secondary_religion_change = {
	country_event = { id = religions_and_cultures_expanded_events.2 days = 1 } # update state assigned missionaries
}

on_monthly_pulse = {
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = rce_missionary_assigned_to_state_modifier
				is_state = no
			}
		}
		every_owned_province = {
			limit = {
				is_state = no
			}
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_main_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_main_modifier
			}
			if = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_modifier
				}
				remove_province_modifier = rce_missionary_assigned_to_state_modifier
			}
			clr_province_flag = rce_missionary_assigned_to_state_flag
			set_variable = { which = rce_missionary_assigned_to_state_year value = 0 }
		}
	}
	export_to_variable = {
		which = rce_num_of_missionaries_temp
		value = modifier:missionaries
	}
	if = {
		limit = {
			NOT = { check_variable = { which = rce_num_of_missionaries_temp value = 0 } }
			any_owned_province = {
				has_province_modifier = rce_missionary_assigned_to_state_modifier
			}
		}
		while = {
			limit = {
				NOT = { check_variable = { which = rce_num_of_missionaries_temp value = 0 } }
			}
			change_variable = { which = rce_num_of_missionaries_temp value = 1 }
			random_owned_province = {
				limit = {
					has_province_modifier = rce_missionary_assigned_to_state_modifier
				}
				area = {
					if = {
						limit = {
							has_province_modifier = rce_missionary_assigned_to_state_main_modifier
						}
						remove_province_modifier = rce_missionary_assigned_to_state_main_modifier
					}
					if = {
						limit = {
							has_province_modifier = rce_missionary_assigned_to_state_modifier
						}
						remove_province_modifier = rce_missionary_assigned_to_state_modifier
					}
					clr_province_flag = rce_missionary_assigned_to_state_flag
					set_variable = { which = rce_missionary_assigned_to_state_year value = 0 }
				}
			}
		}
	}
	set_variable = { which = rce_num_of_missionaries_temp value = 0 }
}

on_harmonized_tibetan_buddhism = {
	on_harmonized_effect = yes
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		rce_religion_tibetan_buddhism_events.1
	}
}

on_new_age = {
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
	}
	if = {
		limit = {
			religion_group = pagan
			capital_scope = {
				continent = europe
			}
			OR = {
				current_age = age_of_discovery
				current_age = age_of_reformation
				current_age = age_of_absolutism
			}
			OR = {
				technology_group = western
				technology_group = eastern
			}
		}
		if = {
			limit = {
				current_age = age_of_discovery
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_discovery
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_reformation
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_reformation
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_absolutism
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_absolutism
				duration = -1
			}
		}
	}
}

on_capital_moved = {
	owner = {
		if = {
			limit = {
				has_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
			}
			remove_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
		}
		if = {
			limit = {
				has_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
			}
			remove_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
		}
		if = {
			limit = {
				has_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
			}
			remove_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
		}
		if = {
			limit = {
				religion_group = pagan
				capital_scope = {
					continent = europe
				}
				OR = {
					current_age = age_of_discovery
					current_age = age_of_reformation
					current_age = age_of_absolutism
				}
				OR = {
					technology_group = western
					technology_group = eastern
				}
			}
			if = {
				limit = {
					current_age = age_of_discovery
				}
				add_country_modifier = {
					name = rce_european_pagan_relations_modifier_age_of_discovery
					duration = -1
				}
			}
			else_if = {
				limit = {
					current_age = age_of_reformation
				}
				add_country_modifier = {
					name = rce_european_pagan_relations_modifier_age_of_reformation
					duration = -1
				}
			}
			else_if = {
				limit = {
					current_age = age_of_absolutism
				}
				add_country_modifier = {
					name = rce_european_pagan_relations_modifier_age_of_absolutism
					duration = -1
				}
			}
		}
	}
}

# ROOT = released country, FROM = releasing country
on_country_released = {
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
	}
	if = {
		limit = {
			religion_group = pagan
			capital_scope = {
				continent = europe
			}
			OR = {
				current_age = age_of_discovery
				current_age = age_of_reformation
				current_age = age_of_absolutism
			}
			OR = {
				technology_group = western
				technology_group = eastern
			}
		}
		if = {
			limit = {
				current_age = age_of_discovery
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_discovery
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_reformation
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_reformation
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_absolutism
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_absolutism
				duration = -1
			}
		}
	}
}

# ROOT = released country
on_country_creation = {
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
	}
	if = {
		limit = {
			religion_group = pagan
			capital_scope = {
				continent = europe
			}
			OR = {
				current_age = age_of_discovery
				current_age = age_of_reformation
				current_age = age_of_absolutism
			}
			OR = {
				technology_group = western
				technology_group = eastern
			}
		}
		if = {
			limit = {
				current_age = age_of_discovery
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_discovery
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_reformation
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_reformation
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_absolutism
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_absolutism
				duration = -1
			}
		}
	}
}

# ROOT = vassal, FROM = overlord
on_create_vassal = {
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_discovery
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_reformation
	}
	if = {
		limit = {
			has_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
		}
		remove_country_modifier = rce_european_pagan_relations_modifier_age_of_absolutism
	}
	if = {
		limit = {
			religion_group = pagan
			capital_scope = {
				continent = europe
			}
			OR = {
				current_age = age_of_discovery
				current_age = age_of_reformation
				current_age = age_of_absolutism
			}
			OR = {
				technology_group = western
				technology_group = eastern
			}
		}
		if = {
			limit = {
				current_age = age_of_discovery
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_discovery
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_reformation
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_reformation
				duration = -1
			}
		}
		else_if = {
			limit = {
				current_age = age_of_absolutism
			}
			add_country_modifier = {
				name = rce_european_pagan_relations_modifier_age_of_absolutism
				duration = -1
			}
		}
	}
}