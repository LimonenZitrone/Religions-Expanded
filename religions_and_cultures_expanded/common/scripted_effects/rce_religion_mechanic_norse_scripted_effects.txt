rce_set_religion_mechanic_norse_norn_value = {
	if = {
		limit = {
			rce_uses_religion_mechanic = { mechanic = norse }
		}
		[[value]
			set_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = $value$ }
		]
		[[which]
			set_variable = { which = rce_religion_mechanic_norse_norn_$type$_value which = $which$ }
		]
		hidden_effect = {
			if = {
				limit = {
					check_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 100 }
				}
				set_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 100 }
			}
			else_if = {
				limit = {
					NOT = { check_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 0 } }
				}
				set_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 0 }
			}
		}
	}
}

rce_add_religion_mechanic_norse_norn_value = {
	if = {
		limit = {
			rce_uses_religion_mechanic = { mechanic = norse }
		}
		[[value]
			change_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = $value$ }
			hidden_effect = {
				set_variable = { which = rce_religion_mechanic_norse_temp_norn_value value = $value$ }
			}
		]
		[[which]
			change_variable = { which = rce_religion_mechanic_norse_norn_$type$_value which = $which$ }
			hidden_effect = {
				set_variable = { which = rce_religion_mechanic_norse_temp_norn_value which = $which$ }
			}
		]
		[[affect_others]
			if = {
				limit = {
					always = $affect_others$
				}
				custom_tooltip = rce_add_religion_mechanic_norse_norn_value_tt_affect_others
			}
		]
		hidden_effect = {
			if = {
				limit = {
					check_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 100 }
				}
				set_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 100 }
			}
			else_if = {
				limit = {
					NOT = { check_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 0 } }
				}
				set_variable = { which = rce_religion_mechanic_norse_norn_$type$_value value = 0 }
			}
			[[affect_others]
				if = {
					limit = {
						always = $affect_others$
					}
					hidden_effect = {
						set_country_flag = rce_add_religion_mechanic_norse_norn_value_affect_others_$type$
						divide_variable = { which = rce_religion_mechanic_norse_temp_norn_value value = -5 }
						if = {
							limit = {
								NOT = { has_country_flag = rce_add_religion_mechanic_norse_norn_value_affect_others_adm }
							}
							rce_add_religion_mechanic_norse_norn_value = {
								type = adm
								which = rce_religion_mechanic_norse_temp_norn_value
							}
						}
						if = {
							limit = {
								NOT = { has_country_flag = rce_add_religion_mechanic_norse_norn_value_affect_others_dip }
							}
							rce_add_religion_mechanic_norse_norn_value = {
								type = dip
								which = rce_religion_mechanic_norse_temp_norn_value
							}
						}
						if = {
							limit = {
								NOT = { has_country_flag = rce_add_religion_mechanic_norse_norn_value_affect_others_mil }
							}
							rce_add_religion_mechanic_norse_norn_value = {
								type = mil
								which = rce_religion_mechanic_norse_temp_norn_value
							}
						}
						clr_country_flag = rce_add_religion_mechanic_norse_norn_value_affect_others_$type$
					}
				}
			]
			set_variable = { which = rce_religion_mechanic_norse_temp_norn_value value = 0 }
		}
	}
}

rce_set_religion_mechanic_norse_era = {
	if = {
		limit = {
			rce_uses_religion_mechanic = { mechanic = norse }
		}
		rce_remove_religion_mechanic_norse_era_flags = yes
		rce_set_religion_mechanic_norse_norn_value = { type = adm value = 0 }
		rce_set_religion_mechanic_norse_norn_value = { type = dip value = 0 }
		rce_set_religion_mechanic_norse_norn_value = { type = mil value = 0 }
		custom_tooltip = rce_set_religion_mechanic_norse_era_tt_$era$
		custom_tooltip = rce_set_religion_mechanic_norse_era_tt_next_era
		[[modifier]
			# only available for adm, dip and mil
			if = {
				limit = {
					always = $modifier$
				}
				add_country_modifier = {
					name = rce_religion_mechanic_norse_modifier_era_$era$
					duration = -1
					desc = rce_religion_mechanic_norse_modifier_era_duration_tt
				}
				rce_export_monthly_religion_mechanic_norse_norn_values_gain = yes
			}
		]
		hidden_effect = {
			set_country_flag = religion_mechanic_norse_era_started
			export_to_variable = {
				which = rce_religion_mechanic_norse_next_era_year
				value = trigger_value:is_year
			}
			change_variable = { which = rce_religion_mechanic_norse_next_era_year value = 20 }
			country_event = { id = rce_religion_mechanic_norse_events.1 days = 7300 }
			set_country_flag = religion_mechanic_norse_era_$era$
			rce_set_religion_mechanic_norse_correct_era_deity_for_selected_deity = yes
		}
	}
}

rce_set_religion_mechanic_norse_correct_era_deity_for_selected_deity = {
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = odin }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = freya }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = tor }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = tyr }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = njord }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = snotra }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = kvasir }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = loki }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = heimdall }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = baldr }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = jesus }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = sleipnir }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = fenrir }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = jormungandr }
	rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = { deity = freyr }
}

rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity_if_active = {
	if = {
		limit = {
			rce_has_religion_mechanic_norse_deity = { deity = $deity$ }
		}
		rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity = { deity = $deity$ }
	}
}

rce_set_religion_mechanic_norse_correct_era_deity_for_specific_deity = {
	if = {
		limit = {
			rce_has_religion_mechanic_norse_era = { era = adm }
		}
		change_personal_deity = $deity$_adm
	}
	else_if = {
		limit = {
			rce_has_religion_mechanic_norse_era = { era = dip }
		}
		change_personal_deity = $deity$_dip
	}
	else_if = {
		limit = {
			rce_has_religion_mechanic_norse_era = { era = mil }
		}
		change_personal_deity = $deity$_mil
	}
	else_if = {
		limit = {
			rce_has_religion_mechanic_norse_era = { era = balance }
		}
		change_personal_deity = $deity$_balance
	}
	else = {
		change_personal_deity = $deity$
	}
}

rce_export_monthly_religion_mechanic_norse_norn_values_gain = {
	hidden_effect = {
		# ADM
		export_to_variable = {
			which = rce_monthly_religion_mechanic_norse_norn_adm_value
			value = modifier:rce_monthly_religion_mechanic_norse_norn_adm_change
		}
		## Corruption
		if = {
			limit = {
				NOT = { corruption = 0.1 }
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = 0.05 }
		}
		else_if = {
			limit = {
				corruption = 1
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = -0.05 }
		}
		## Inflation
		if = {
			limit = {
				NOT = { inflation = 1 }
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = 0.05 }
		}
		else_if = {
			limit = {
				inflation = 2
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = -0.05 }
		}
		## Stability
		if = {
			limit = {
				stability = 3
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = 0.1 }
		}
		else_if = {
			limit = {
				stability = 2
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = 0.05 }
		}
		else_if = {
			limit = {
				NOT = { stability = 0 }
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = -0.05 }
		}
		else_if = {
			limit = {
				NOT = { stability = -1 }
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = -0.1 }
		}
		else_if = {
			limit = {
				NOT = { stability = -2 }
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = -0.15 }
		}
		# DIP
		export_to_variable = {
			which = rce_monthly_religion_mechanic_norse_norn_dip_value
			value = modifier:rce_monthly_religion_mechanic_norse_norn_dip_change
		}
		## Allies
		if = {
			limit = {
				num_of_allies = 1
			}
			every_ally = {
				PREV = {
					change_variable = { which = rce_monthly_religion_mechanic_norse_norn_dip_value value = 0.05 }
				}
			}
		}
		## Subjects
		if = {
			limit = {
				num_of_subjects = 1
				any_subject_country = {
					is_colonial_nation = no
					is_subject_other_than_tributary_trigger = yes
				}
			}
			every_subject_country = {
				limit = {
					is_colonial_nation = no
					is_subject_other_than_tributary_trigger = yes
				}
				PREV = {
					change_variable = { which = rce_monthly_religion_mechanic_norse_norn_dip_value value = 0.05 }
				}
			}
		}
		# MIL
		export_to_variable = {
			which = rce_monthly_religion_mechanic_norse_norn_mil_value
			value = modifier:rce_monthly_religion_mechanic_norse_norn_mil_change
		}
		if = {
			limit = {
				is_at_war = yes
			}
			change_variable = { which = rce_monthly_religion_mechanic_norse_norn_mil_value value = 0.05 }
		}
	}
}

rce_add_monthly_religion_mechanic_norse_values = {
	rce_export_monthly_religion_mechanic_norse_norn_values_gain = yes
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value_temp which = rce_monthly_religion_mechanic_norse_norn_adm_value }
	rce_add_religion_mechanic_norse_norn_value = {
		type = adm
		which = rce_monthly_religion_mechanic_norse_norn_adm_value_temp
	}
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value_temp value = 0 }
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_dip_value_temp which = rce_monthly_religion_mechanic_norse_norn_dip_value }
	rce_add_religion_mechanic_norse_norn_value = {
		type = dip
		which = rce_monthly_religion_mechanic_norse_norn_dip_value_temp
	}
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_dip_value_temp value = 0 }
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_mil_value_temp which = rce_monthly_religion_mechanic_norse_norn_mil_value }
	rce_add_religion_mechanic_norse_norn_value = {
		type = mil
		which = rce_monthly_religion_mechanic_norse_norn_mil_value_temp
	}
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_mil_value_temp value = 0 }
}

rce_remove_religion_mechanic_norse_era_flags = {
	hidden_effect = {
		clr_country_flag = religion_mechanic_norse_era_started
		clr_country_flag = religion_mechanic_norse_era_adm
		clr_country_flag = religion_mechanic_norse_era_dip
		clr_country_flag = religion_mechanic_norse_era_mil
		clr_country_flag = religion_mechanic_norse_era_balance
		clr_country_flag = religion_mechanic_norse_era_all
		remove_country_modifier = rce_religion_mechanic_norse_modifier_era_adm
		remove_country_modifier = rce_religion_mechanic_norse_modifier_era_dip
		remove_country_modifier = rce_religion_mechanic_norse_modifier_era_mil
	}
}

rce_clear_all_religion_mechanic_norse_modifiers = {
	rce_remove_religion_mechanic_norse_era_flags = yes
	set_variable = { which = rce_religion_mechanic_norse_norn_adm_value value = 0 }
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_adm_value value = 0 }
	set_variable = { which = rce_religion_mechanic_norse_norn_dip_value value = 0 }
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_dip_value value = 0 }
	set_variable = { which = rce_religion_mechanic_norse_norn_mil_value value = 0 }
	set_variable = { which = rce_monthly_religion_mechanic_norse_norn_mil_value value = 0 }
	set_variable = { which = rce_religion_mechanic_norse_next_era_year value = 0 }
	clr_country_flag = rce_religion_mechanic_will_get_norse_prophecy
	clr_country_flag = rce_religion_mechanic_norse_unlocked_jesus
	clr_country_flag = rce_religion_mechanic_norse_unlocked_sleipnir
	clr_country_flag = rce_religion_mechanic_norse_unlocked_fenrir
	clr_country_flag = rce_religion_mechanic_norse_unlocked_jormungandr
	clr_country_flag = rce_religion_mechanic_norse_unlocked_freyr
}

rce_clear_all_religion_mechanic_norse_modifiers_when_changing_religion = {
	if = {
		limit = {
			rce_not_uses_religion_mechanic = { mechanic = norse }
		}
		rce_clear_all_religion_mechanic_norse_modifiers = yes
	}
}