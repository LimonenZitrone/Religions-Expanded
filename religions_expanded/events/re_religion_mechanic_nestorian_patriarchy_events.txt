namespace = re_religion_mechanic_nestorian_patriarchy_events

country_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.1
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME1
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC1
	picture = RELIGION_eventPicture

	major = yes
	major_trigger = {
		re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
	}
	is_triggered_only = yes

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events1.EVTOPT1

		ai_chance = { factor = 100 }

		tooltip = {
			re_set_religion_mechanic_nestorian_patriarchy_patriarchy_controller = yes
		}
	}
}

province_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.2
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME2
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC2
	picture = RELIGION_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			change_religion = nestorian
			remove_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_target_modifier
			add_permanent_province_modifier = {
				name = religious_zeal_at_conv
				duration = 10950
			}
			owner = {
				export_to_variable = {
					which = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_target_dev
					value = trigger_value:development
					who = PREV
				}
			}
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events2.EVTOPT1

		trigger = {
			owner = {
				re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			}
		}

		custom_tooltip = re_religion_mechanic_nestorian_patriarchy_events.2.tt
		owner = {
			re_add_religion_mechanic_nestorian_patriarchy_value = { which = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_target_dev }
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events2.EVTOPT2

		trigger = {
			owner = {
				re_not_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			}
		}

		custom_tooltip = re_religion_mechanic_nestorian_patriarchy_events.2.tt
	}

	after = {
		owner = {
			set_variable = { which = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_target_dev value = 0 }
		}
	}
}

province_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.3
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME3
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC3
	picture = RELIGION_eventPicture

	hidden = yes
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0 }
			every_country = {
				limit = {
					re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
				}
				set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0 }
				# Prestige
				export_to_variable = {
					which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp
					value = trigger_value:prestige
				}
				divide_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = 4 }
				change_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp }
				# Legitimacy Equivalent
				if = {
					limit = {
						OR = {
							uses_legitimacy = yes
							uses_republican_tradition = yes
							uses_devotion = yes
							uses_meritocracy = yes
							uses_horde_unity = yes
						}
					}
					export_to_variable = {
						which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp
						value = trigger_value:legitimacy_equivalent
					}
				}
				else = {
					set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = 100 }
				}
				divide_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = 4 }
				change_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp }
				# Diplomatic Reputation
				export_to_variable = {
					which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp
					value = modifier:diplomatic_reputation
				}
				multiply_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = 3 }
				change_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp }
				# Corruption
				export_to_variable = {
					which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp
					value = trigger_value:corruption
				}
				multiply_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = -5 }
				change_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp }
				# Stability
				export_to_variable = {
					which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp
					value = trigger_value:stability
				}
				multiply_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = 5 }
				change_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp }
				# Religious Unity
				export_to_variable = {
					which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp
					value = trigger_value:religious_unity
				}
				multiply_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = 20 }
				change_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp }
				if = {
					limit = {
						NOT = { check_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0.001 } }
					}
					set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0.001 }
				}
				PREV = { change_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = PREV } }
			}
			set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_total which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight }
			random_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_total }
			if = {
				limit = {
					NOT = { check_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0.001 } }
				}
				set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0.001 }
			}
			every_country = {
				limit = {
					re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
				}
				if = {
					limit = {
						PREV = { check_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0.001 } }
					}
					PREV = {
						subtract_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight which = PREV }
						if = {
							limit = { NOT = { check_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0.001 } } }
							PREV = { save_event_target_as = next_patriarchy_controller }
						}
					}
				}
			}
			set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0 }
			set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_total value = 0 }
			every_country = {
				limit = {
					re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
				}
				set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight value = 0 }
				set_variable = { which = re_religion_mechanic_nestorian_patriarchy_new_controller_weight_temp value = 0 }
			}
			if = {
				limit = {
					NOT = { has_saved_event_target = next_patriarchy_controller }
				}
				random_country = {
					limit = {
						re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
					}
					save_event_target_as = next_patriarchy_controller
				}
			}
			if = {
				limit = {
					has_saved_event_target = next_patriarchy_controller
				}
				event_target:next_patriarchy_controller = {
					re_set_religion_mechanic_nestorian_patriarchy_patriarchy_controller = yes
				}
			}
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events3.EVTOPT1

		ai_chance = { factor = 100 }
	}
}

# Simulation of the ruler death of the Patriarchy if that doesn't exist
country_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.4
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME4
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC4
	picture = RELIGION_eventPicture

	hidden = yes

	trigger = {
		re_religion_mechanic_nestorian_patriarchy_is_patriarchy_controller = yes
		NOT = { exists = NPA }
	}

	mean_time_to_happen = {
		years = 15
	}

	immediate = {
		hidden_effect = {
			151 = {
				province_event = { id = re_religion_mechanic_nestorian_patriarchy_events.3 } # New Patriarchy Controller
			}
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events4.EVTOPT1

		ai_chance = { factor = 100 }
	}
}

country_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.5
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME5
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC5
	picture = POPE_PREACHING_eventPicture

	major = yes
	major_trigger = {
		re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
	}

	trigger = {
		owns = 151
		re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
		NOT = { has_country_flag = re_religion_mechanic_nestorian_patriarchy_no_constantinople }
		NOT = { exists = NPA }
	}

	mean_time_to_happen = {
		months = 3
		modifier = {
			factor = 0.75
			has_idea_group = religious_ideas
		}
		modifier = {
			factor = 0.9
			is_defender_of_faith = yes
		}
		modifier = {
			factor = 1.1
			NOT = { is_defender_of_faith = yes }
		}
		modifier = {
			factor = 1.1
			NOT = { advisor = theologian }
		}
		modifier = {
			factor = 0.9
			theologian = 2
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events5.EVTOPT1

		ai_chance = {
			factor = 0.25
		}

		151 = {
			add_core = NPA
		}
		add_prestige = -10
		add_stability = -1
		every_country = {
			limit = {
				NOT = { tag = ROOT }
				religion = ROOT
			}
			add_opinion = {
				who = ROOT
				modifier = re_religion_mechanic_nestorian_patriarchy_no_constantinople_opinion
			}
		}
		set_country_flag = re_religion_mechanic_nestorian_patriarchy_no_constantinople
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events5.EVTOPT2

		ai_chance = {
			factor = 0.75
			modifier = {
				factor = 0
				is_subject = yes
				overlord = { ai = no }
			}
		}

		151 = {
			add_core = NPA
			cede_province = NPA
			if = {
				limit = {
					is_core = ROOT
				}
				remove_core = ROOT
			}
			change_culture = greek
		}
		add_prestige = 25
		NPA = {
			change_religion = nestorian
			hidden_effect = {
				change_primary_culture = greek
				change_government = theocracy
				add_government_reform = nestorian_patriarchy_constantinople_reform
				adopt_reform_progress = FROM
				add_country_modifier = {
					name = no_revolution_here_country_dummy
					duration = -1
					hidden = yes
				}
				set_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
				define_ruler = {
					min_age = 60
					max_age = 70
				}
				clr_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
			}
		}
		hidden_effect = {
			every_country = {
				limit = {
					re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
				}
				re_export_yearly_religion_mechanic_nestorian_patriarchy_value_gain = yes
			}
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events5.EVTOPT3

		trigger = {
			ai = no
		}

		ai_chance = {
			factor = 0
		}

		151 = {
			add_core = NPA
			cede_province = NPA
			if = {
				limit = {
					is_core = ROOT
				}
				remove_core = ROOT
			}
			change_culture = greek
		}
		add_prestige = 25
		NPA = {
			change_religion = nestorian
			hidden_effect = {
				change_primary_culture = greek
				change_government = theocracy
				add_government_reform = nestorian_patriarchy_constantinople_reform
				adopt_reform_progress = FROM
				add_country_modifier = {
					name = no_revolution_here_country_dummy
					duration = -1
					hidden = yes
				}
				set_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
				define_ruler = {
					min_age = 60
					max_age = 70
				}
				clr_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
			}
		}
		switch_tag = NPA
		hidden_effect = {
			every_country = {
				limit = {
					re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
				}
				re_export_yearly_religion_mechanic_nestorian_patriarchy_value_gain = yes
			}
		}
	}
}

country_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.6
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME6
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC6
	picture = BAD_WITH_MONARCH_eventPicture

	major = yes
	major_trigger = {
		re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
	}
	is_triggered_only = yes

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events6.EVTOPT1

		ai_chance = { factor = 100 }

		tooltip = {
			add_country_modifier = {
				name = re_religion_mechanic_nestorian_patriarchy_excommunicated_modifier
				duration = -1
				desc = re_religion_mechanic_nestorian_patriarchy_excommunicated_modifier_tt
			}
		}
	}
}

country_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.7
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME7
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC7
	picture = GOOD_WITH_MONARCH_eventPicture

	major = yes
	major_trigger = {
		re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
	}
	is_triggered_only = yes

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events7.EVTOPT1

		ai_chance = { factor = 100 }
	}
}

country_event = {
	id = re_religion_mechanic_nestorian_patriarchy_events.8
	title = re_religion_mechanic_nestorian_patriarchy_events.EVTNAME8
	desc = re_religion_mechanic_nestorian_patriarchy_events.EVTDESC8
	picture = RELIGION_eventPicture

	is_triggered_only = yes

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT1

		trigger = {
			has_discovered = 118
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 118 }
			}
		}

		ai_chance = {
			factor = 100
		}

		118 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT2

		trigger = {
			has_discovered = 1816
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 1816 }
			}
		}

		ai_chance = {
			factor = 100
		}

		1816 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT3

		trigger = {
			has_discovered = 1099
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 1099 }
			}
		}

		ai_chance = {
			factor = 100
		}

		1099 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT4

		trigger = {
			has_discovered = 151
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 151 }
			}
		}

		ai_chance = {
			factor = 100
		}

		151 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT5

		trigger = {
			has_discovered = 4293
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 4293 }
			}
		}

		ai_chance = {
			factor = 100
		}

		4293 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT6

		trigger = {
			has_discovered = 4447
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 4447 }
			}
		}

		ai_chance = {
			factor = 100
		}

		4447 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT7

		trigger = {
			has_discovered = 358
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 358 }
			}
		}

		ai_chance = {
			factor = 100
		}

		358 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT8

		trigger = {
			has_discovered = 735
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 735 }
			}
		}

		ai_chance = {
			factor = 100
		}

		735 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT9

		trigger = {
			has_discovered = 85
			any_province = {
				province_religion = nestorian
				re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 85 }
			}
		}

		ai_chance = {
			factor = 100
		}

		85 = {
			re_set_religion_mechanic_nestorian_patriarchy_center_of_reformation = yes
		}
	}

	option = {
		name = re_religion_mechanic_nestorian_patriarchy_events8.EVTOPT10

		ai_chance = {
			factor = 0
		}
	}

	after = {
		clr_country_flag = re_religion_mechanic_nestorian_patriarchy_selecting_center_of_reformation
	}
}