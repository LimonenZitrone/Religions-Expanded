on_religion_change = {
	re_clear_all_religion_mechanic_nestorian_patriarchy_modifiers_when_changing_religion = yes
	if = {
		limit = {
			re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			NOT = { has_saved_global_event_target = re_religion_mechanic_nestorian_patriarchy_patriarch_controller }
		}
		re_set_religion_mechanic_nestorian_patriarchy_patriarchy_controller = yes
	}
	if = {
		limit = {
			re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			has_saved_global_event_target = re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation
		}
		if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 118
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 118 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 1816
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 1816 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 1099
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 1099 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 151
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 151 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 4293
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 4293 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 4447
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 4447 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 358
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 358 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 735
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 735 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
		else_if = {
			limit = {
				event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
					province_id = 85
				}
			}
			every_owned_province = {
				limit = {
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 85 }
					NOT = { religion = nestorian }
				}
				add_permanent_province_modifier = {
					name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
					duration = -1
				}
			}
		}
	}
	else_if = {
		limit = {
			re_not_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			any_owned_province = {
				has_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
			}
		}
		every_owned_province = {
			limit = {
				has_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
			}
			remove_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
		}
	}

	# Antioch Patriarchy
	if = {
		limit = {
			tag = NPA
			re_not_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
		}
		change_religion = nestorian
	}
}

on_province_owner_change = {
	if = {
		limit = {
			has_saved_global_event_target = re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation
			NOT = { religion = nestorian }
			owner = {
				re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			}
			OR = {
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 118
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 118 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 1816
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 1816 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 1099
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 1099 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 151
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 151 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 4293
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 4293 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 4447
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 4447 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 358
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 358 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 735
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 735 }
				}
				AND = {
					event_target:re_religion_mechanic_nestorian_patriarchy_current_center_of_reformation = {
						province_id = 85
					}
					re_religion_mechanic_nestorian_patriarchy_is_in_regions_for_center_of_reformation = { id = 85 }
				}
			}
		}
		add_permanent_province_modifier = {
			name = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
			duration = -1
		}
	}
	else_if = {
		limit = {
			has_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
		}
		remove_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
	}
}

on_province_religion_changed = {
	if = {
		limit = {
			has_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
			religion = nestorian
		}
		remove_province_modifier = re_religion_mechanic_nestorian_patriarchy_center_of_reformation_region_modifier
	}
}

on_monthly_pulse = {
	if = {
		limit = {
			re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
		}
		# yearly value / 12 is added
		re_add_yearly_religion_mechanic_nestorian_patriarchy_value = yes
	}
	if = {
		limit = {
			has_country_flag = re_religion_mechanic_nestorian_patriarchy_is_patriarchy_controller
			OR = {
				NOT = { has_saved_global_event_target = re_religion_mechanic_nestorian_patriarchy_patriarch_controller }
				AND = {
					has_saved_global_event_target = re_religion_mechanic_nestorian_patriarchy_patriarch_controller
					event_target:re_religion_mechanic_nestorian_patriarchy_patriarch_controller = {
						NOT = { tag = ROOT }
					}
				}
			}
		}
		save_global_event_target_as = re_religion_mechanic_nestorian_patriarchy_patriarch_controller
	}
}

on_monarch_death = {
	# Antioch Patriarchy
	if = {
		limit = {
			tag = NPA
			re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			NOT = { has_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death }
		}
		2313 = {
			province_event = { id = re_religion_mechanic_nestorian_patriarchy_events.3 } # New Patriarchy Controller
		}
	}
}

# ROOT = annexing country, FROM = annexed country
on_annexed = {
	FROM = {
		if = {
			limit = {
				re_uses_religion_mechanic = { mechanic = nestorian_patriarchy }
			}
			re_clear_all_religion_mechanic_nestorian_patriarchy_modifiers_when_changing_religion = yes
		}
	}
}

# ROOT = released country, FROM = releasing country
on_country_released = {
	re_clear_all_religion_mechanic_nestorian_patriarchy_modifiers = yes

	# Antioch Patriarchy
	if = {
		limit = {
			tag = NPA
		}
		change_religion = nestorian
		change_government = theocracy
		add_government_reform = nestorian_patriarchy_antioch_reform
		adopt_reform_progress = FROM
		add_country_modifier = {
			name = no_revolution_here_country_dummy
			duration = -1
			hidden = yes
		}
		set_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
		define_ruler = {
			min_age = 60
			max_age = 70
		}
		clr_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
	}
	else_if = {
		limit = {
			FROM = { has_reform = religious_permanent_revolution_reform }
		}
		change_religion = FROM
		adopt_reform_progress = FROM
		add_country_modifier = {
			name = global_holy_war_released_modifier
			duration = 3650
			hidden = yes
		}
		capital_scope = {
			change_religion = FROM
		}
	}
}

# ROOT = released country
on_country_creation = {
	re_clear_all_religion_mechanic_nestorian_patriarchy_modifiers = yes

	# Antioch Patriarchy
	if = {
		limit = {
			tag = NPA
		}
		change_religion = nestorian
		change_government = theocracy
		add_government_reform = nestorian_patriarchy_antioch_reform
		add_country_modifier = {
			name = no_revolution_here_country_dummy
			duration = -1
			hidden = yes
		}
		set_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
		define_ruler = {
			min_age = 60
			max_age = 70
		}
		clr_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
	}
}

# ROOT = vassal, FROM = overlord
on_create_vassal = {
	re_clear_all_religion_mechanic_nestorian_patriarchy_modifiers = yes

	# Antioch Patriarchy
	if = {
		limit = {
			tag = NPA
		}
		change_religion = nestorian
		change_government = theocracy
		add_government_reform = nestorian_patriarchy_antioch_reform
		adopt_reform_progress = FROM
		add_country_modifier = {
			name = no_revolution_here_country_dummy
			duration = -1
			hidden = yes
		}
		set_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
		define_ruler = {
			min_age = 60
			max_age = 70
		}
		clr_country_flag = re_religion_mechanic_nestorian_patriarchy_no_new_patriarchy_controller_on_ruler_death
	}
}